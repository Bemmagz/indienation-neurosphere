<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INDIENATION - SOVEREIGN LEDGER</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #000; color: #fff; text-align: center; padding: 20px; }
        .container { max-width: 500px; margin: auto; }
        .box { background: #111; padding: 30px; border: 1px solid #222; border-radius: 20px; }
        input { width: 100%; padding: 15px; margin: 20px 0; background: #000; color: #fff; border: 1px solid #333; border-radius: 10px; text-align: center; }
        button { background: #fff; color: #000; border: none; padding: 15px; font-weight: bold; width: 100%; border-radius: 10px; cursor: pointer; }
        .result-box { margin-top: 30px; padding: 20px; border-radius: 15px; display: none; border: 1px solid #333; }
    </style>
</head>
<body>
    <div class="container">
        <h1>INDIENATION</h1>
        <div class="box">
            <input type="text" id="walletId" placeholder="ENTER IID (e.g. 1)">
            <button onclick="checkIID()">VERIFY & CLAIM</button>
        </div>
        <div id="result" class="result-box"></div>
    </div>

    <script>
        // KONEKSI DATABASE BARU FOUNDER
        const _URL = "https://jpcofjankomicljstmqw.supabase.co";
        const _KEY = "sb_publishable_mEVj4dOChpttajAhj7mUMA_3gAeYfa1";
        const supabase = supabase.createClient(_URL, _KEY);

        async function checkIID() {
            let input = document.getElementById('walletId').value.trim();
            // Standarisasi IID ke format 10 digit (Skala 10 Miliar)
            const idNum = input.replace(/\D/g,'');
            const iid = "INDIE-" + idNum.padStart(10, '0');
            const resultDiv = document.getElementById('result');
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = "Authenticating with AI Guard...";

            const isFounder = (idNum === "1");
            const name = isFounder ? "INDIE-Founder" : "INDIE-Citizen";

            resultDiv.innerHTML = `
                <h2 style="color:${isFounder ? '#00e1ff' : '#fff'}">${name}</h2>
                <p>${iid}</p>
                <button id="btnClaim" onclick="processClaim('${iid}')">CONFIRM GENESIS CLAIM</button>
            `;
        }

        async function processClaim(iid) {
            const btn = document.getElementById('btnClaim');
            btn.innerHTML = "RECORDING TO SUPABASE...";
            btn.disabled = true;

            // KIRIM DATA KE SUPABASE (Tanpa Overwrite)
            const { error } = await supabase.from('claims').insert([{ iid: iid, status: 'ACTIVE' }]);

            if (error) {
                if (error.code === '23505') {
                    alert("IDENTITY ALREADY ACTIVATED!");
                    btn.innerHTML = "ALREADY CLAIMED";
                } else {
                    alert("ERROR: " + error.message);
                    btn.innerHTML = "RETRY CLAIM";
                    btn.disabled = false;
                }
            } else {
                alert("SUCCESS! Sovereign Identity Secured.");
                btn.innerHTML = "IDENTITY VERIFIED";
            }
        }
    </script>
</body>
</html>
